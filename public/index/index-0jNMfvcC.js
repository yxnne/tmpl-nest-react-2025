import{a as e,L as s,u as t,b as l,c as a,r as n,j as r,M as i,S as c,R as o,d,T as h,D as m,A as u,e as x,B as p,O as j,f as y,g,h as f,i as w,C as I,F as S,I as b,k as C,s as k,l as v,P as z,m as F,n as q,o as M,p as O,q as K,t as B,v as P,N as $,w as L,x as A,y as D,z as E,E as N}from"../js/vendor-fTY2Ij05.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const R="token",T=()=>localStorage.getItem(R)||"",W=e=>{try{const s=e.split(".");if(3!==s.length)return null;const t=atob(s[1].replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(t)}catch{return null}},V=e(null),{Header:_,Sider:H,Content:J}=s;function U(){const e=t(),f=l(),[w]=a(V),I=T(),S=W(I),b=w?.username||S?.username||"未登录",[C,k]=n.useState(!1),v=re(),z=e=>e.map(e=>({key:e.path,icon:e.icon,label:r.jsx(y,{to:e.path,children:e.title}),children:e.children?z(e.children.filter(e=>!e.hideInMenu)):void 0})),F=z(v),q=ne(e.pathname,ae),M=q.slice(0,-1).map(e=>e.path),O={items:[{key:"profile",icon:r.jsx(x,{}),label:"个人信息"},{type:"divider"},{key:"logout",icon:r.jsx(g,{}),label:"退出登录",onClick:()=>{localStorage.removeItem(R),f("/login",{replace:!0})}}]};return r.jsxs(s,{style:{minHeight:"100vh"},children:[r.jsxs(H,{collapsible:!0,collapsed:C,onCollapse:k,width:208,theme:"light",children:[r.jsx("div",{style:{height:48,display:"flex",alignItems:"center",padding:"0 16px",fontWeight:600},children:C?"菜单":"导航菜单"}),r.jsx(i,{selectedKeys:[e.pathname],openKeys:M,items:F,mode:"inline"})]}),r.jsxs(s,{children:[r.jsxs(_,{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 16px",background:"#fff"},children:[r.jsxs(c,{children:[r.jsx("span",{onClick:()=>k(!C),style:{cursor:"pointer",fontSize:18},children:C?r.jsx(o,{}):r.jsx(d,{})}),r.jsx(h.Title,{level:5,style:{margin:0},children:"系统名称"})]}),r.jsx(m,{menu:O,trigger:["click"],children:r.jsxs(c,{style:{cursor:"pointer"},children:[r.jsx(u,{size:24,icon:r.jsx(x,{})}),b]})})]}),r.jsxs(J,{style:{padding:16},children:[r.jsx("div",{style:{marginBottom:12},children:r.jsx(p,{items:q.map(e=>({title:r.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.icon,e.title]})}))})}),r.jsx(j,{})]})]})]})}const G=f.create({baseURL:"/api"});G.interceptors.request.use(e=>{const s=T();return s&&(e.headers=e.headers||{},e.headers.authorization=`Bearer ${s}`),e});function Q(){const[e,s]=n.useState(!1),a=l(),i=t(),o=i.state?.from?.pathname||"/system",d=w(V);return r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},children:r.jsx(I,{style:{width:360},children:r.jsxs(c,{direction:"vertical",style:{width:"100%"},size:"middle",children:[r.jsx(h.Title,{level:4,style:{margin:0},children:"系统登录"}),r.jsxs(S,{layout:"vertical",onFinish:async e=>{try{s(!0);const r=await(l=e.username,n=e.password,G.post("/auth/login",{username:l,password:n}).then(e=>e.data));t=r.access_token,localStorage.setItem(R,t);const i=W(r.access_token);d({username:i?.username,roles:i?.roles}),i?.username&&k.success(`欢迎 ${i.username}`),a(o,{replace:!0})}catch(r){k.error(r.message||"登录失败")}finally{s(!1)}var t,l,n},requiredMark:!1,children:[r.jsx(S.Item,{name:"username",label:"用户名/邮箱/手机号",rules:[{required:!0}],children:r.jsx(b,{placeholder:"输入邮箱"})}),r.jsx(S.Item,{name:"password",label:"密码",rules:[{required:!0}],children:r.jsx(b.Password,{placeholder:"输入密码"})}),r.jsx(S.Item,{children:r.jsx(C,{type:"primary",htmlType:"submit",block:!0,loading:e,children:"登录"})})]})]})})})}const X=(e=1,s=15,t)=>G.get("/roles",{params:{page:e,pageSize:s,...t||{}}}).then(e=>e.data),Y=e=>G.delete(`/roles/${e}`).then(e=>e.data),Z=(e=1,s=15,t)=>G.get("/users",{params:{page:e,pageSize:s,...t||{}}}).then(e=>e.data),ee=e=>G.delete(`/users/${e}`).then(e=>e.data);function se(){const[e,s]=n.useState([]),[t,l]=n.useState([]),[a,i]=n.useState(!1),[o,d]=n.useState(!1),[h,m]=n.useState(null),[u]=S.useForm(),[x]=S.useForm(),[p,j]=n.useState(!1),[y,g]=n.useState([]),[f,w]=n.useState(1),[O,K]=n.useState(15),[B,P]=n.useState(0),$=n.useMemo(()=>t.map(e=>({label:e.name,value:e.id})),[t]),L=async(e=f,t=O)=>{i(!0);try{const a=x.getFieldsValue(),[n,r]=await Promise.all([Z(e,t,a),X(1,100)]);s(n.items),P(n.total),w(n.page),K(n.pageSize),l(r.items)}catch(a){k.error(a.message||"加载失败")}finally{i(!1)}};n.useEffect(()=>{L()},[]);const A=e,D=[{title:"ID",dataIndex:"id",width:80},{title:"姓名",dataIndex:"name"},{title:"邮箱",dataIndex:"email"},{title:"手机号",dataIndex:"phone"},{title:"角色",dataIndex:"roleId",render:e=>t.find(s=>s.id===e)?.name||"-"},{title:"操作",width:200,render:(e,s)=>r.jsxs(c,{children:[r.jsx(C,{size:"small",type:"link",onClick:()=>(e=>{m(e),u.setFieldsValue({name:e.name,email:e.email,roleId:e.roleId}),d(!0)})(s),children:"编辑"}),r.jsx(z,{title:"确认删除该用户?",onConfirm:()=>(async e=>{try{await ee(e.id),k.success("删除成功"),await L()}catch(s){k.error(s.message||"删除失败")}})(s),children:r.jsx(C,{size:"small",type:"link",danger:!0,children:"删除"})})]})}],E={selectedRowKeys:y,onChange:e=>g(e)};return r.jsxs(I,{bordered:!1,style:{background:"#fff"},children:[r.jsxs(c,{direction:"vertical",style:{width:"100%"},size:"middle",children:[r.jsxs("div",{children:[r.jsx(c,{style:{marginBottom:12},children:r.jsx("span",{style:{fontSize:18,fontWeight:600},children:"用户管理"})}),r.jsxs(S,{form:x,layout:"inline",onFinish:()=>{w(1),L(1,O)},children:[r.jsx(S.Item,{name:"name",label:"姓名",children:r.jsx(b,{allowClear:!0,placeholder:"输入姓名"})}),r.jsx(S.Item,{name:"email",label:"邮箱",children:r.jsx(b,{allowClear:!0,placeholder:"输入邮箱"})}),r.jsx(S.Item,{name:"roleId",label:"角色",children:r.jsx(v,{allowClear:!0,options:$,style:{minWidth:120},placeholder:"选择角色"})}),p&&r.jsxs(r.Fragment,{children:[r.jsx(S.Item,{name:"phone",label:"手机号",children:r.jsx(b,{allowClear:!0,placeholder:"输入手机号"})}),r.jsx(S.Item,{name:"id",label:"ID",children:r.jsx(b,{allowClear:!0,placeholder:"精确匹配"})})]}),r.jsxs(c,{children:[r.jsx(C,{type:"primary",onClick:()=>x.submit?.(),children:"查询"}),r.jsx(C,{onClick:()=>{x.resetFields(),w(1),L(1,O)},children:"重置"}),r.jsx(C,{onClick:()=>j(!p),children:p?"收起":"展开"})]})]})]}),r.jsxs(c,{children:[r.jsx(C,{type:"primary",onClick:()=>{m(null),u.resetFields(),d(!0)},children:"新建"}),r.jsx(C,{onClick:()=>L(),children:"刷新"}),r.jsx(z,{title:"确认批量删除选中用户?",onConfirm:async()=>{try{for(const e of y)await ee(e);k.success("批量删除成功"),g([]),await L()}catch(e){k.error(e.message||"批量删除失败")}},disabled:!y.length,children:r.jsx(C,{danger:!0,disabled:!y.length,children:"批量删除"})})]}),r.jsx(F,{type:"info",showIcon:!0,message:r.jsxs("span",{children:["已选择: ",y.length," 项"]})}),r.jsx("div",{style:{height:"calc(100vh - 320px)"},children:r.jsx(q,{rowKey:"id",sticky:!0,loading:a,dataSource:A,columns:D,pagination:{current:f,pageSize:O,total:B,showSizeChanger:!0},size:"small",rowSelection:E,scroll:{y:"calc(100vh - 420px)"},onChange:e=>{w(e.current||1),K(e.pageSize||15),L(e.current||1,e.pageSize||15)}})})]}),r.jsx(M,{open:o,title:h?"编辑用户":"新增用户",onOk:async()=>{try{const t=await u.validateFields();if(h){const l={name:t.name,email:t.email};t.password&&(l.password=t.password),await(e=h.id,s=l,G.patch(`/users/${e}`,s).then(e=>e.data)),void 0!==t.roleId&&await((e,s)=>G.patch(`/users/${e}/role`,{roleId:s}).then(e=>e.data))(h.id,t.roleId),k.success("更新成功")}else await(e=>G.post("/users",e).then(e=>e.data))({name:t.name,email:t.email,password:t.password}),k.success("创建成功");d(!1),await L()}catch(t){if(t?.errorFields)return;k.error(t.message||"提交失败")}var e,s},onCancel:()=>d(!1),destroyOnClose:!0,children:r.jsxs(S,{form:u,layout:"vertical",requiredMark:!1,children:[r.jsx(S.Item,{name:"name",label:"姓名",rules:[{required:!0}],children:r.jsx(b,{placeholder:"请输入姓名"})}),r.jsx(S.Item,{name:"email",label:"邮箱",rules:[{required:!0,type:"email"}],children:r.jsx(b,{placeholder:"请输入邮箱"})}),r.jsx(S.Item,{name:"password",label:h?"新密码":"密码",rules:h?[]:[{required:!0,min:6}],children:r.jsx(b.Password,{placeholder:h?"可留空不修改":"至少 6 位"})}),r.jsx(S.Item,{name:"roleId",label:"角色",children:r.jsx(v,{allowClear:!0,options:$,placeholder:"选择角色"})}),r.jsx(S.Item,{name:"phone",label:"手机号",children:r.jsx(b,{placeholder:"请输入手机号"})})]})})]})}function te(){const[e,s]=n.useState([]),[t,l]=n.useState(!1),[a,i]=n.useState(!1),[o,d]=n.useState(null),[h]=S.useForm(),[m]=S.useForm(),[u,x]=n.useState(!1),[p,j]=n.useState([]),[y,g]=n.useState(1),[f,w]=n.useState(15),[v,O]=n.useState(0),K=async(e=y,t=f)=>{l(!0);try{const l=m.getFieldsValue(),a=await X(e,t,l);s(a.items),O(a.total),g(a.page),w(a.pageSize)}catch(a){k.error(a.message||"加载失败")}finally{l(!1)}};n.useEffect(()=>{K()},[]);const B=e,P=[{title:"ID",dataIndex:"id",width:80},{title:"名称",dataIndex:"name"},{title:"描述",dataIndex:"description"},{title:"操作",width:200,render:(e,s)=>r.jsxs(c,{children:[r.jsx(C,{size:"small",type:"link",onClick:()=>(e=>{d(e),h.setFieldsValue({name:e.name,description:e.description}),i(!0)})(s),children:"编辑"}),r.jsx(z,{title:"确认删除该角色?",onConfirm:()=>(async e=>{try{await Y(e.id),k.success("删除成功"),await K()}catch(s){k.error(s.message||"删除失败")}})(s),children:r.jsx(C,{size:"small",type:"link",danger:!0,children:"删除"})})]})}],$={selectedRowKeys:p,onChange:e=>j(e)};return r.jsxs(I,{bordered:!1,style:{background:"#fff"},children:[r.jsxs(c,{direction:"vertical",style:{width:"100%"},size:"middle",children:[r.jsxs("div",{children:[r.jsx(c,{style:{marginBottom:12},children:r.jsx("span",{style:{fontSize:18,fontWeight:600},children:"角色管理"})}),r.jsxs(S,{form:m,layout:"inline",onFinish:()=>{g(1),K(1,f)},children:[r.jsx(S.Item,{name:"name",label:"名称",children:r.jsx(b,{allowClear:!0,placeholder:"输入角色名称"})}),u&&r.jsx(S.Item,{name:"description",label:"描述",children:r.jsx(b,{allowClear:!0,placeholder:"输入描述"})}),u&&r.jsx(S.Item,{name:"id",label:"ID",children:r.jsx(b,{allowClear:!0,placeholder:"精确匹配"})}),r.jsxs(c,{children:[r.jsx(C,{type:"primary",onClick:()=>m.submit?.(),children:"查询"}),r.jsx(C,{onClick:()=>{m.resetFields(),g(1),K(1,f)},children:"重置"}),r.jsx(C,{onClick:()=>x(!u),children:u?"收起":"展开"})]})]})]}),r.jsxs(c,{children:[r.jsx(C,{type:"primary",onClick:()=>{d(null),h.resetFields(),i(!0)},children:"新建"}),r.jsx(C,{onClick:()=>K(),children:"刷新"}),r.jsx(z,{title:"确认批量删除选中角色?",onConfirm:async()=>{try{for(const e of p)await Y(e);k.success("批量删除成功"),j([]),await K()}catch(e){k.error(e.message||"批量删除失败")}},disabled:!p.length,children:r.jsx(C,{danger:!0,disabled:!p.length,children:"批量删除"})})]}),r.jsx(F,{type:"info",showIcon:!0,message:r.jsxs("span",{children:["已选择: ",p.length," 项"]})}),r.jsx("div",{style:{height:"calc(100vh - 320px)"},children:r.jsx(q,{rowKey:"id",sticky:!0,loading:t,dataSource:B,columns:P,pagination:{current:y,pageSize:f,total:v,showSizeChanger:!0},size:"small",rowSelection:$,scroll:{y:"calc(100vh - 420px)"},onChange:e=>{g(e.current||1),w(e.pageSize||15),K(e.current||1,e.pageSize||15)}})})]}),r.jsx(M,{open:a,title:o?"编辑角色":"新增角色",onOk:async()=>{try{const t=await h.validateFields();o?(await(e=o.id,s=t,G.patch(`/roles/${e}`,s).then(e=>e.data)),k.success("更新成功")):(await(e=>G.post("/roles",e).then(e=>e.data))(t),k.success("创建成功")),i(!1),await K()}catch(t){if(t?.errorFields)return;k.error(t.message||"提交失败")}var e,s},onCancel:()=>i(!1),destroyOnClose:!0,children:r.jsxs(S,{form:h,layout:"vertical",requiredMark:!1,children:[r.jsx(S.Item,{name:"name",label:"名称",rules:[{required:!0}],children:r.jsx(b,{placeholder:"请输入角色名称"})}),r.jsx(S.Item,{name:"description",label:"描述",children:r.jsx(b,{placeholder:"请输入描述"})})]})})]})}function le(){return r.jsx("div",{children:r.jsxs(c,{direction:"vertical",style:{width:"100%"},size:"small",children:[r.jsx(h.Title,{level:4,style:{margin:0},children:"系统管理"}),r.jsx(O,{defaultActiveKey:"users",items:[{key:"users",label:"用户管理",children:r.jsx(se,{})},{key:"roles",label:"角色管理",children:r.jsx(te,{})}]})]})})}const ae=[{path:"/login",title:"登录",element:r.jsx(Q,{}),hideInMenu:!0},{path:"/",title:"首页",icon:r.jsx(P,{}),requireAuth:!0,element:r.jsx(U,{}),children:[{path:"/system",title:"系统管理",icon:r.jsx(B,{}),element:r.jsx(le,{}),children:[{path:"/system/users",title:"用户管理",icon:r.jsx(x,{}),element:r.jsx(se,{})},{path:"/system/roles",title:"角色管理",icon:r.jsx(K,{}),element:r.jsx(te,{})}]}]},{path:"*",title:"跳转",hideInMenu:!0,element:r.jsx($,{to:"/system",replace:!0})}],ne=(e,s)=>{let t=[];const l=(s,a)=>{for(const n of s){if(e===n.path||e.startsWith(n.path+"/")||"/"===n.path&&"/"===e){const e=[...a,n];e.length>t.length&&(t=e),n.children&&l(n.children,e)}}};return l(s,[]),t},re=()=>{const e=ae.find(e=>"/"===e.path);return e?.children?.filter(e=>!e.hideInMenu)||[]},ie=({children:e})=>{const s=T(),l=t();return s?r.jsx(r.Fragment,{children:e||r.jsx(j,{})}):r.jsx($,{to:"/login",state:{from:l},replace:!0})},ce=e=>e.map(e=>{const s=e.children?ce(e.children):void 0,t=e.element||r.jsx(j,{}),l=e.requireAuth?r.jsx(ie,{children:t}):t;return r.jsx(A,{path:e.path,element:l,children:s},e.path)});function oe(){return r.jsx(L,{children:ce(ae)})}D.createRoot(document.getElementById("root")).render(r.jsx(n.StrictMode,{children:r.jsx(E,{children:r.jsx(N,{theme:{components:{Button:{fontSize:14}}},componentSize:"small",children:r.jsx(oe,{})})})}));
